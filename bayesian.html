<!DOCTYPE html><html><head><title>thomas: Bayesian Analysis</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="@kailuowang" /><meta name="description" content="Thomas, a library for A/B tests" /><meta name="og:image" content="/thomas/img/poster.png" /><meta name="image" property="og:image" content="/thomas/img/poster.png" /><meta name="og:title" content="thomas: Bayesian Analysis" /><meta name="title" property="og:title" content="thomas: Bayesian Analysis" /><meta name="og:site_name" content="thomas" /><meta name="og:url" content="https://github.com/iheartradio/thomas" /><meta name="og:type" content="website" /><meta name="og:description" content="Thomas, a library for A/B tests" /><link rel="icon" type="image/png" href="/thomas/img/favicon.png" /><meta name="twitter:title" content="thomas: Bayesian Analysis" /><meta name="twitter:image" content="/thomas/img/poster.png" /><meta name="twitter:description" content="Thomas, a library for A/B tests" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/thomas/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/thomas/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/thomas/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/thomas/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/thomas/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/thomas/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/thomas/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/thomas/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/thomas/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/thomas/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/thomas/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/thomas/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/thomas/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/thomas/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/thomas/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/thomas/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/thomas/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/thomas/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/thomas/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/thomas/img/favicon310x150.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/thomas/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/thomas/css/light-style.css" /></head><body class="page"><nav id="navigation" aria-labelledby="main-navigation"><div class="navbar-wrapper container"><div class="navigation-brand"><a href="/thomas/" class="brand background-mask"><div class="page-icon-wrapper"></div><span class="brand-title">thomas</span></a></div><div class="navigation-menu"><ul><li><a href="https://github.com/iheartradio/thomas" target="_blank" rel="noopener noreferrer"><i class="nav-item-icon fa fa-lg fa-github" hidden="true"></i><span class="nav-item-text">GitHub</span></a></li><li><a href="/thomas/api/com/iheart/thomas/index.html"><i class="nav-item-icon fa fa-lg fa-file-text" hidden="true"></i><span class="nav-item-text">API Documentation</span></a></li></ul></div></div></nav><nav class="menu-container" aria-labelledby="section-navigation"><div id="horizontal-menu"><ul class="horizontal-nav"><li><a class="" href="/thomas/">Home</a></li><li><a class="" href="/thomas/get-started.html">Get Started</a></li><li><a class="" href="/thomas/core.html">Core concepts</a></li><li><a class="" href="/thomas/FAQ.html">FAQ</a></li><li><a class=" active " href="/thomas/bayesian.html">Bayesian Analysis</a></li></ul></div></nav><main id="site-main" class="page-site-main"><section class="use"><div class="container"><div id="content"><p>Thomas provides a module thomas-analysis that can be used to perform Bayesian analysis for A/B test results.
 This library is built using the wonderful <a href="https://github.com/stripe/rainier">Bayesian inference library Rainier</a>
 .  Using this thomas-analysis, users can write analysis tools that compute a posterior distribution of the effect
  of the treatment v.s. control using Markov Chain Monte Carlo.</p>

<p>In its essence, the A/B test analysis’s main task is that, given the observed difference in analytics results 
between multiple treatment groups, pick the treatment that works best towards the goal for the product. 
The traditional frequentist approach has been trying to determine whether the difference observed is statistically
 significantly or not. The Bayesian analysis allows us to answer a different question: given the observed difference, 
 what will be the risk of picking one treatment over another. In another sentence, what will be the maximum reduction 
 of KPI in the scenario when one treatment is chosen over another but the real difference is the opposite of the one
  saw in the experiment.</p>

<p>The Bayesian A/B analysis tool in Thomas produces results that look like the following.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Group:   Treatment A
 Count:   53179
 Chance of better than control: 0.82692
 Expected Benefit: 0.03209179240152402
 Median Benefit: 0.02028449645941638
 Risk of Using: -0.014472377020694363
 Risk of Not Using: -0.05524666066837561
 Plot:
|                                                                                
|                                 ○                                              
|                                 ○○                                             
|                             ∘○· ○○ ∘                                           
|                             ○○○○○○ ○·                                          
|                          ∘∘·○○○○○○○○○··                                        
|                         ∘○○○○○○○○○○○○○○∘                                       
|                        ∘○○○○○○○○○○○○○○○○·○                                     
|                       ·○○○○○○○○○○○○○○○○○○○○                                    
|                      ○○○○○○○○○○○○○○○○○○○○○○                                    
|                     ·○○○○○○○○○○○○○○○○○○○○○○                                    
|                   ∘∘○○○○○○○○○○○○○○○○○○○○○○○∘∘                                  
|                 ∘∘○○○○○○○○○○○○○○○○○○○○○○○○○○○∘                                 
|                ·○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○∘                                
|               ∘○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○∘                               
|              ∘○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○∘·                             
|            ·∘○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○∘·                           
|            ○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○                          
|        ·∘○∘○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○∘∘                        
|    ·∘·○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○···                    
|··∘∘○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○○∘∘··········  ·   ·
|--------|--------|--------|--------|--------|--------|--------|--------|--------
 -0.039   -0.023   -0.007   0.010    0.026    0.042    0.058    0.075    0.091  

</code></pre></div></div>

<p>To use these utilities users need to implement integration with data retrieval from their analytical system.</p>

<p>The core class that provides the Bayesian analysis is <a href="https://iheartradio.github.io/thomas/api/com/iheart/thomas/client/AnalysisAPI.html">AnalysisAPI</a> provided in <code class="language-plaintext highlighter-rouge">thomas-client</code></p>

<p>This API is parameterized to the effect type <code class="language-plaintext highlighter-rouge">F[_]</code> and KPI model  type <code class="language-plaintext highlighter-rouge">K</code></p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">trait</span> <span class="nc">AnalysisAPI</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>, <span class="kt">K</span> <span class="k">&lt;:</span> <span class="kt">KPIModel</span><span class="o">]</span> 
</code></pre></div></div>
<p>KPI stands for Key Performance Indicator, it is what we use to evaluate the effect of a treatment. One example is the conversion (or click through) rate, another example is average user engagement time. Each KPI can be modeled as a certain type of distribution. For example conversion rate is often modeled using the Beta distribution. One can choose to use the Gamma distribution to model the user engagement time. In fact these are two types of KPI distributions Thomas supports out of box at the time of writing. User can implement their own <code class="language-plaintext highlighter-rouge">KPIDistribution</code>, it will require knowledge of Bayesian inference and <a href="https://github.com/stripe/rainier">Rainier</a> the MCMC library used in Thomas.</p>

<p>Thus depending on which type of KPI you are analyzing, you need to instantiate different type of <code class="language-plaintext highlighter-rouge">AnalysisAPI</code>. Take Gamma KPI distribution as an example:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.iheart.thomas.client._</span>
<span class="k">import</span> <span class="nn">com.iheart.thomas.client.AbtestClient.HttpServiceUrlsPlay</span>
<span class="k">import</span> <span class="nn">cats.effect.IO</span>
<span class="k">import</span> <span class="nn">com.iheart.thomas.analysis._</span>
<span class="k">import</span> <span class="nn">concurrent.ExecutionContext.Implicits.global</span>


<span class="c1">//these are Url to your Thomas http service instance that provides tests and kpi endpoints</span>
<span class="k">val</span> <span class="nv">httpServiceUrl</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">HttpServiceUrlsPlay</span><span class="o">(</span><span class="s">"http://localhost/internal"</span><span class="o">)</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="nv">conextShift</span> <span class="k">=</span> <span class="nv">IO</span><span class="o">.</span><span class="py">contextShift</span><span class="o">(</span><span class="n">global</span><span class="o">)</span>

<span class="nv">Http4SAbtestClient</span><span class="o">.</span><span class="py">resource</span><span class="o">[</span><span class="kt">IO</span><span class="o">](</span><span class="n">httpServiceUrl</span><span class="o">,</span> <span class="n">global</span><span class="o">).</span><span class="py">use</span> <span class="o">{</span> <span class="k">implicit</span> <span class="n">client</span> <span class="k">=&gt;</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="nv">measurable</span><span class="k">:</span> <span class="kt">Measurable</span><span class="o">[</span><span class="kt">IO</span>, <span class="kt">Measurements</span>, <span class="kt">LogNormalKPIModel</span><span class="o">]</span> <span class="k">=</span> <span class="kc">null</span>  <span class="c1">//user needs to implement a Measurable, null used here so that code compiles </span>
  <span class="k">val</span> <span class="nv">analysisAPI</span><span class="k">:</span> <span class="kt">AnalysisAPI</span><span class="o">[</span><span class="kt">IO</span>, <span class="kt">LogNormalKPIModel</span><span class="o">]</span> <span class="k">=</span> <span class="n">implicitly</span>
  <span class="c1">//do something with analysisAPI</span>
  <span class="nc">IO</span><span class="o">(</span><span class="nf">println</span><span class="o">(</span><span class="s">"done"</span><span class="o">))</span> 
<span class="o">}.</span><span class="py">unsafeRunSync</span>

</code></pre></div></div>
<p>Note that in this code the user needs to provide a Client instance which will be used to retrieve A/B tests information and manage KPI from the Thomas service. Uer also needs to implement a <code class="language-plaintext highlighter-rouge">GammaMeasurable</code>, an alias for <a href="https://iheartradio.github.io/thomas/api/com/iheart/thomas/analysis/Measurable.html">Measurable</a>. This trait is responsible for getting the raw measurements of users of each group from the Analytics data.</p>

<p>Once we have an instance of <code class="language-plaintext highlighter-rouge">AnalysisAPI</code>, we can</p>
<ol>
  <li>initialize a KPI with prior distribution using historical data</li>
  <li>update the KPI’s prior distribution using more recent historical data</li>
  <li>assess the results of an A/B test</li>
</ol>

<p>For more detail regarding these methods please check <a href="https://iheartradio.github.io/thomas/api/com/iheart/thomas/client/AnalysisAPI.html">AnalysisAPI’s API documentation</a></p>

</div></div></section></main><footer id="site-footer"><div class="container"><div class="row"><p>thomas is designed and developed by <a href="https://github.com/iheartradio/thomas" target="_blank" rel="noopener noreferrer">@kailuowang</a></p></div><div class="row"><div><p>Website built with <a href="https://47degrees.github.io/sbt-microsites/" target="_blank" rel="noopener noreferrer">sbt-microsites</a> - © 2019 <a href="https://www.47deg.com/" target="_blank" rel="noopener noreferrer">47 Degrees</a></p></div></div></div></footer><script src="/thomas/highlight/highlight.pack.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script>((window.gitter = {}).chat = {}).options = {
room: 'iheartradio/thomas'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/thomas/js/version-selector.js"></script></body></html>