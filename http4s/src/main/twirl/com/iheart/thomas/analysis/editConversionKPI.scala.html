@import com.iheart.thomas.analysis._
@import com.iheart.thomas.stream._
@import com.iheart.thomas.stream.html._
@import com.iheart.thomas.html._
@import com.iheart.thomas.admin.User
@import com.iheart.thomas.http4s.ReverseRoutes

@(
kpi: ConversionKPI,
u: User,
runningJobO: Option[Job],
successMsg: Option[String] = None
)(implicit routes: ReverseRoutes)

@topNav(s"Editing Conversion KPI ${kpi.name}", u) {

<form action="../conversionKPIs/@kpi.name" method="post">

    @conversionKPIForm(Some(kpi), u, successMsg, false)

    <div class="row d-flex flex-row-reverse mt-5">
        <div class="mr-5">
            <button type="submit" class="btn btn-primary">
                Update
            </button>
            <a href="@routes.analysis" role="button" class="btn btn-warning ml-2">Never Mind</a>
        </div>
    </div>


</form>

    <div class="row mt-3">
        <div class="col-6">
            <div id="kpi-update-prior" class="card">
                <div class="card-header">
                    <span class="h5">Update prior using ongoing data</span>
                </div>
                <div class="card-body">
                    @if(runningJobO.isEmpty) {

                    <form action="../conversionKPIs/@kpi.name/update-prior" method="post">
                        <div class="form-group">
                            <label for="sampleSizeInput">Sample Size</label>
                            <input name="sampleSize"
                                   required
                                   class="form-control"
                                   id="sampleSizeInput"
                                   type="number"
                                   step="1"
                            />
                        </div>
                        <div class="row d-flex flex-row-reverse mt-5">
                            <div class="mr-4">
                                <button type="submit" class="btn btn-primary">
                                    Schedule Prior Update
                                </button>
                            </div>
                        </div>
                    </form>
                    } else {
                        @for(job <- runningJobO) {
                            <span class="h5 font-weight-light text-success">
                              @job.spec.description
                            </span>
                            @jobStatusBadge(job)

                        }
                    }

                </div>
            </div>

        </div>
    </div>
}