@import com.iheart.thomas.abtest.model.Abtest
@import lihua.Entity
@import java.time.OffsetDateTime
@import com.iheart.thomas.http4s.Formatters._

@(tests: Vector[Entity[Abtest]], endAfter: Option[OffsetDateTime] = None)


@main("tests") {
<h4>Abtests</h4>

<form id="tests-filters" action="tests" method="get">
  <label for="testEndAfter">Show tests that end after</label>
  <input name="endAfter" class="form-control" id="testEndAfter"
         type="text"
         value="@endAfter.map(formatDate)"/>
  <button class="btn btn-primary" type="submit">Apply</button>
</form>

<div class="list-group">
  @for(test <- tests) {

  <a href="tests/@test._id" class="list-group-item list-group-item-action flex-column align-items-start">
    <div class="d-flex w-100 justify-content-between">
      <h5 class="mb-1">@test.data.feature : <span class="font-weight-light">@test.data.name</span></h5>

    </div>
    <span class="badge badge-@formatStatus(test)._2">
      @formatStatus(test)._1
    </span>
    <small>
      <span class="font-weight-heavy">Start: </span>
        @formatDate(test.data.start, dateTimeFormatterShort)
    </small>
    @for(end <- test.data.end) {
    <small><span class="font-weight-heavy">
        End: </span>
      @formatDate(end, dateTimeFormatterShort)</small>
    }
    <small><span class="font-weight-heavy">
      Author: </span>@test.data.author
    </small>
  </a>
  }
</div>
<a href="tests/new">
  <button class="btn btn-primary">New Test</button>
</a>
}


<script>
  var pickerSettings =  {
    'format': 'Y-m-d H:i:s T'
  };
  $('#testEndAfter').datetimepicker(pickerSettings);

</script>
